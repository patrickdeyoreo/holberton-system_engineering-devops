#!/usr/bin/env bash
#
# Manage the 'manage_my_process' daemon

exename='manage_my_process'
exepath="${BASH_SOURCE[0]%/*}/${exename}"
pidfile="${XDG_RUNTIME_DIR}/my_process.pid"
declare -A message=(
  ['start']='started'
  ['stop']='stopped'
  ['restart']='restarted'
)

start() {
  exec -- "${exepath}" & echo "$!" >| "${pidfile}"
}

stop() {
  trap '
    trap RETURN
    rm -f -- "${pidfile}"
  ' RETURN
  kill -- "$(< "${pidfile}")"
}

restart() {
  stop
  start
}

if (( $# == 1 )) && [[ $1 == @(start|stop|restart) ]]
then
  "$1" && printf '%s %s\n' "${exename}" "${message[$1]}"
else
  printf 'Usage: %s {start|stop|restart}\n' "${exename}"
  exit 1
fi
